<li x-cloak
    class="card bg-base-100 shadow-sm m-2 w-full max-w-full"
    data-episode-id="{{ episode.pk }}"
    data-environment="{{ episode.inference.checkpoint.training.environment }}"
    data-algorithm="{{ episode.inference.checkpoint.training.algorithm }}"
    data-created="{{ episode.inference.created|date:'c' }}">
    <div class="card-body p-2! m-2! w-full max-w-full overflow-hidden">
        <!-- Episode Header -->
        <div class="card-title">
            <label for="{{ episode.pk }}-checkbox">
                <input id="{{ episode.pk }}-checkbox"
                       type="checkbox"
                       value="{{ episode.pk }}"
                       x-model="selectedEpisodes"
                       @change="updateAllowedEnvironment('{{ episode.inference.checkpoint.training.environment }}')"
                       class="checkbox checkbox-primary"
                       data-environment="{{ episode.inference.checkpoint.training.environment }}"
                       :disabled="allowedEnvironment && allowedEnvironment !== '{{ episode.inference.checkpoint.training.environment }}'" />
            </label>
            <a href="{% url 'insights' %}?episode_id={{ episode.pk }}"
               class="group flex items-center gap-2 p-2 -m-2 rounded-lg hover:bg-primary/10 transition-all duration-200 cursor-pointer"
               title="View insights for {{ episode.inference.checkpoint.training.environment }}">
                <h2 class="group-hover:text-primary group-hover:underline decoration-2 underline-offset-4 transition-all duration-200">
                    {{ episode.inference.checkpoint.training.environment }}
                </h2>
                <i class="ri-external-link-line text-sm opacity-0 group-hover:opacity-100 transition-all duration-200"></i>
            </a>
        </div>
        <!-- Episode Details -->
        <div class="flex flex-wrap justify-between items-center gap-2 w-full max-w-full">
            <!-- Algorithm & Iterations -->
            <div class="flex gap-2 capitalize flex-wrap min-w-0 flex-shrink">
                <p class="text-gray-400 whitespace-nowrap">Algorithm:</p>
                <span class="truncate">{{ episode.inference.checkpoint.training.algorithm }} &#8226;
                    {{ episode.inference.checkpoint.training.iterations }} Iterations
                    {% if episode.inference.checkpoint.training.parallel %}&#8226; Parallel{% endif %}
                </span>
            </div>
            <!-- Created Date -->
            <div class="flex gap-2 whitespace-nowrap flex-shrink-0">
                <p class="text-gray-400">Created:</p>
                {{ episode.inference.created|date:"D d M Y" }}
                {{ episode.inference.created|time:"H:i" }}
            </div>
            <!-- Open episode details modal -->
            <div class="flex-shrink-0">
                {% include "core/partials/episode_details_modal.html" with episode=episode %}
            </div>
        </div>
    </div>
</li>
