<aside x-data="{ collapsed: false, settingsOpen: false }"
       class="
        bg-base-100
        rounded-lg
        shadow-md
        p-3
        w-auto
        transition-all
      "
>
  <button x-show="collapsed" x-cloak @click="collapsed = false"
          class="btn btn-primary btn-ghost"
          title="Expand" aria-expanded="false">
    <i class="ri-menu-unfold-line"></i>
  </button>

  <div x-show="!collapsed" x-cloak class="w-2xs flex flex-col gap-2">
    <header class="flex items-center justify-between">
      <button @click="collapsed = true"
              class="btn btn-primary btn-ghost"
              title="Collapse" aria-expanded="true">
        <i class="ri-menu-fold-line"></i>
      </button>
      <a href="{% url 'home' %}" class="btn btn-primary btn-ghost" title="Home">
        <i class="ri-home-4-line"></i>
        <h2 class="text-sm font-semibold tracking-wide">MIXTAPE</h2>
      </a>
    </header>

    <div class="divider my-0"></div>

    <header class="flex items-center justify-between">
      <h2 class="text-base font-semibold">Settings & Tools</h2>
      <button @click="settingsOpen = !settingsOpen"
              class="btn btn-primary btn-ghost"
              title="Settings" :aria-expanded="settingsOpen">
        <i :class="settingsOpen ? 'ri-settings-3-fill' : 'ri-settings-3-line'"></i>
      </button>
    </header>

    <section x-show="!settingsOpen" x-cloak class="card card-border border-base-300">
      <div class="card-body">
        <h3 class="card-title text-base">Selected Episodes</h3>
        <ul class="list">
          <template x-for="episodeSummary in $store.insights.episodeSummaries" :key="episodeSummary.id">
            <li class="list-row" x-text="`Episode ${episodeSummary.id}`"></li>
          </template>
        </ul>
      </div>
    </section>

    <section x-show="settingsOpen" x-cloak class="card card-border border-base-300">
      <div class="card-body">
        <h3 class="card-title text-base">Playback</h3>
        <label class="flex items-center gap-6 text-sm">
          Speed
          <span>
            <input type="number" min="0.1" max="10" step="0.1"
                   x-model.number="$store.settings.playbackSpeed"
                   class="input input-sm validator w-15 text-right"
            />
            <span class="text-xs">x Speed</span>
          </span>
        </label>
      </div>
    </section>

    <section x-show="settingsOpen && $store.insights.episodeSummaries.length > 1" x-cloak class="card card-border border-base-300">
      <div class="card-body">
        <h3 class="card-title text-base">Timeline</h3>
          <div class="flex items-center gap-2 mb-2">
            <label class="flex items-center gap-2 text-sm">
              <input type="radio" name="timeline-mode" value="true"
                     x-model.boolean="$store.settings.useGlobalTimeline"
                     class="radio radio-sm"
              />
              Use global timeline
            </label>
          </div>
          <div class="flex items-center gap-2">
            <label class="flex items-center gap-2 text-sm">
              <input type="radio" name="timeline-mode" value="false"
                     x-model.boolean="$store.settings.useGlobalTimeline"
                     class="radio radio-sm"
              />
              Use episode timeline
            </label>
            <select class="select select-sm w-36"
                    :class="{ 'disabled': ! $store.settings.useGlobalTimeline }"
                    :disabled="$store.settings.useGlobalTimeline"
                    x-model.number="$store.settings.timelineEpisodeIdx"
            >
              <template x-for="(episodeSummary, idx) in $store.insights.episodeSummaries" :key="episodeSummary.id">
                <option :value="idx" x-text="`Episode ${episodeSummary.id}`"></option>
              </template>
            </select>
          </div>
      </div>
    </section>

    <section x-show="settingsOpen" x-cloak class="card card-border border-base-300">
      <div class="card-body">
        <h3 class="card-title text-base">Visibility</h3>
        <div class="flex flex-col gap-2">
          <h4 class="text-xs opacity-60 mb-1">Global</h4>
          <div class="grid grid-cols-2 gap-2">
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" x-model.boolean="$store.settings.showPlayback"
                     class="checkbox checkbox-sm"
              />
              Playback Controls
            </label>
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" x-model.boolean="$store.settings.showEpisodeInfo"
                     class="checkbox checkbox-sm"
              />
              Step Details
            </label>
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" x-model.boolean="$store.settings.showMediaViewer"
                     class="checkbox checkbox-sm"
              />
              Media Viewer
            </label>
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" x-model.boolean="$store.settings.showTimeline"
                     class="checkbox checkbox-sm"
              />
              Timeline
            </label>
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" x-model.boolean="$store.settings.showPlotLegends"
                     class="checkbox checkbox-sm"
              />
              Plot Legends
            </label>
          </div>
        </div>
        <div>
          <h4 class="text-xs opacity-60 mb-1">Overview</h4>
          <div class="grid grid-cols-2 gap-2">
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" x-model.boolean="$store.settings.showPlotActionRewardFrequency"
                     class="checkbox checkbox-sm"
              />
              Action vs Reward
            </label>
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" x-model.boolean="$store.settings.showPlotRewardFrequency"
                     class="checkbox checkbox-sm"
              />
              Reward Frequency
            </label>
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" x-model.boolean="$store.settings.showPlotActionFrequency"
                     class="checkbox checkbox-sm"
              />
              Action Frequency
            </label>
          </div>
        </div>
        <div>
          <h4 class="text-xs opacity-60 mb-1">Rewards</h4>
          <div class="grid grid-cols-2 gap-2">
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" x-model.boolean="$store.settings.showPlotRewardsTime"
                     class="checkbox checkbox-sm"
              />
              Rewards Over Time
            </label>
          </div>
        </div>
        <div>
          <h4 class="text-xs opacity-60 mb-1">Agents</h4>
          <div class="grid grid-cols-2 gap-2">
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" x-model.boolean="$store.settings.showPlotObservationClustering"
                     class="checkbox checkbox-sm"
              />
              Observation Clustering
            </label>
            <label class="flex items-center gap-2 text-sm">
              <input type="checkbox" x-model.boolean="$store.settings.showPlotActionClustering"
                     class="checkbox checkbox-sm"
              />
              Action Clustering
            </label>
          </div>
        </div>
      </div>
    </section>
  </div>
</aside>
