<aside x-data="{ collapsed: false, settingsOpen: false }"
       class="
        bg-[var(--color-surface)]
        text-[var(--color-surface-foreground)]
        rounded-lg
        border
        border-[var(--color-border)]
        shadow-md
        p-3
        w-auto
        transition-all
      "
>
  <button x-show="collapsed" x-cloak @click="collapsed = false"
          class="btn btn-primary btn-ghost"
          title="Expand" aria-expanded="false">
    <i class="ri-menu-unfold-line"></i>
  </button>

  <div x-show="!collapsed" x-cloak class="w-2xs">
    <header class="flex items-center justify-between">
      <button @click="collapsed = true"
              class="btn btn-primary btn-ghost"
              title="Collapse" aria-expanded="true">
        <i class="ri-menu-fold-line"></i>
      </button>
      <a href="{% url 'home' %}" class="btn btn-primary btn-ghost" title="Home">
        <i class="ri-home-4-line"></i>
        <h2 class="text-sm font-semibold tracking-wide">MIXTAPE</h2>
      </a>
    </header>

    <hr class="border-[var(--color-border)] my-2" />

    <header class="flex items-center justify-between mb-3">
      <h2 class="text-base font-semibold">Settings & Tools</h2>
      <button @click="settingsOpen = !settingsOpen"
              class="btn btn-primary btn-ghost"
              title="Settings" :aria-expanded="settingsOpen">
        <i :class="settingsOpen ? 'ri-settings-3-fill' : 'ri-settings-3-line'"></i>
      </button>
    </header>

    <section x-show="!settingsOpen" x-cloak class="card p-3">
      <h3 class="text-sm font-medium mb-2">Selected Episodes</h3>
      <ul class="text-sm space-y-1">
        <template x-for="episodeSummary in $store.insights.episodeSummaries" :key="episodeSummary.id">
          <li class="flex items-center justify-between">
            <span x-text="`Episode ${episodeSummary.id}`"></span>
          </li>
        </template>
      </ul>
    </section>

    <section x-show="settingsOpen" x-cloak class="card p-3">
      <h3 class="text-sm font-medium mb-2">Playback</h3>
      <div class="">
        <label class="flex items-center gap-6 text-sm">
          Speed
          <span>
            <input type="number" min="0.1" max="10" step="0.1"
                   x-model.number="$store.settings.playbackSpeed"
                   class="input w-15 text-right"
            />
            <span class="text-xs">x Speed</span>
          </span>
        </label>
      </div>
    </section>

    <section class="card p-3" x-show="$store.insights.episodeSummaries.length > 1" x-cloak>
      <h3 class="text-sm font-medium mb-2">Timeline</h3>
        <div class="flex items-center gap-2 mb-2">
          <label class="flex items-center gap-2 text-sm">
            <input type="radio" name="timeline-mode" value="true"
                   x-model.boolean="$store.settings.useGlobalTimeline"
                   class="radio"
            />
            Use global timeline
          </label>
        </div>
        <div class="flex items-center gap-2">
          <label class="flex items-center gap-2 text-sm">
            <input type="radio" name="timeline-mode" value="false"
                   x-model.boolean="$store.settings.useGlobalTimeline"
                   class="radio"
            />
            Use episode timeline
          </label>
          <select class="select w-36"
                  :class="{ 'disabled': ! $store.settings.useGlobalTimeline }"
                  :disabled="$store.settings.useGlobalTimeline"
                  x-model.number="$store.settings.timelineEpisodeIdx"
          >
            <template x-for="(episodeSummary, idx) in $store.insights.episodeSummaries" :key="episodeSummary.id">
              <option :value="idx" x-text="`Episode ${episodeSummary.id}`"></option>
            </template>
          </select>
        </div>
    </section>

    <section x-show="settingsOpen" x-cloak class="card p-3 flex flex-col gap-2">
      <h3 class="text-sm font-medium">Visibility</h3>
      <div>
        <h4 class="text-xs text-[var(--color-muted-foreground)] mb-1">Global</h4>
        <div class="grid grid-cols-2 gap-2">
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" x-model.boolean="$store.settings.showPlayback"
                   class="checkbox"
            />
            Playback Controls
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" x-model.boolean="$store.settings.showEpisodeInfo"
                   class="checkbox"
            />
            Episode Info
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" x-model.boolean="$store.settings.showMediaViewer"
                   class="checkbox"
            />
            Media Viewer
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" x-model.boolean="$store.settings.showTimeline"
                   class="checkbox"
            />
            Timeline
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" x-model.boolean="$store.settings.showPlotLegends"
                   class="checkbox"
            />
            Plot Legends
          </label>
        </div>
      </div>
      <div>
        <h4 class="text-xs text-[var(--color-muted-foreground)] mb-1">Overview</h4>
        <div class="grid grid-cols-2 gap-2">
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" x-model.boolean="$store.settings.showPlotActionRewardFrequency"
                   class="checkbox"
            />
            Action vs Reward
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" x-model.boolean="$store.settings.showPlotRewardFrequency"
                   class="checkbox"
            />
            Reward Frequency
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" x-model.boolean="$store.settings.showPlotActionFrequency"
                   class="checkbox"
            />
            Action Frequency
          </label>
        </div>
      </div>
      <div>
        <h4 class="text-xs text-[var(--color-muted-foreground)] mb-1">Rewards</h4>
        <div class="grid grid-cols-2 gap-2">
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" x-model.boolean="$store.settings.showPlotRewardsTime"
                   class="checkbox"
            />
            Rewards Over Time
          </label>
        </div>
      </div>
      <div>
        <h4 class="text-xs text-[var(--color-muted-foreground)] mb-1">Agents</h4>
        <div class="grid grid-cols-2 gap-2">
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" x-model.boolean="$store.settings.showPlotObservationClustering"
                   class="checkbox"
            />
            Observation Clustering
          </label>
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" x-model.boolean="$store.settings.showPlotActionClustering"
                   class="checkbox"
            />
            Action Clustering
          </label>
        </div>
      </div>
    </section>
  </div>
</aside>
